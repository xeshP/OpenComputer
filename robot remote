component = require("component")

event = require("event")
m=component.modem
m.open(6)


crit = function()
    inputa = {}
    for substring in line:gmatch("%S+") do
        table.insert(inputa, substring)
        end
    if inputa[2] == nil then
        anzahl = 1
        else
            anzahl = tonumber(inputa[2])
            end

    if inputa[1] == "w" then
        mover("robot.swing();robot.forward()", anzahl)
        else if inputa[1] == "a" then
            mover("robot.turnLeft()", anzahl)
            else if inputa[1] == "s" then
                mover("robot.back()", anzahl)
                else if inputa[1] == "d" then
                    mover("robot.turnRight()", anzahl)
                    else if inputa[1] == "u" then
                        mover("robot.swing();robot.up()", anzahl)
                        else if inputa[1] == "dd" then
                            mover("robot.swing();robot.down()", anzahl)
                            else if inputa[1] == "sinfo" or inputa[1] == "exinfo" then
                                if inputa[1] == "sinfo" then
                                    m.broadcast(5, "sinfo")
                                else
                                    m.broadcast(5, "exinfo")
                                end
                                        
                                messo = false
                                while messo == false do
                                    local e, _, _, _, _, stableC = event.pull()
                                    if e == "modem_message" then
                                        stable = require("serialization").unserialize(stableC)

                                        for slot in pairs(stable) do
                                            
                                            if type(stable[slot]) == "string" then
                                                print(stable[slot])
                                                end
                                            end
                                        messo = true
                                        end
                                    end
                                else if inputa[1] == "select" then
                                    rce("robot.select("..anzahl..")")
                                    else if inputa[1] == "rce" then
                                        rceline = io.read()
                                        rce(rceline)
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
            
        end
    end
    



rce = function(rcecommand)
    m.broadcast(5, rcecommand)
    messi = false
    while messi == false do
        local e, _, _, _, _, msgo = event.pull()
        if e == "modem_message" then
        print(msgo)
        messi = true
        end
    end
end






mover = function(dir, anzahl)
    while anzahl >= 1 do
        m.broadcast(5, dir)
        anzahl = (anzahl-1)
        end
    mess = false
    rnd = 0
    while mess == false do
        local e, _, _, _, _, msg = event.pull()
        if e == "modem_message" then
        print(msg)
        mess = true
        end
    end
end





ex = false
while ex == false do
    round = 0
    anzahl = 1
    line = io.read()
    if line == "exit" then
        ex = true
        else
            crit()
        end
    end
